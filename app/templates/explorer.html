<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>My Github/ {{ subpath if subpath else branch }}</title>
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-white text-gray-900 font-sans">
  <div class="border-b px-6 py-4 flex items-center justify-between">
    <div class="flex items-center space-x-4">
      <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.438 9.8 8.205 11.385.6.112.82-.26.82-.577v-2.024c-3.338.726-4.033-1.415-4.033-1.415-.546-1.387-1.333-1.756-1.333-1.756-1.09-.744.083-.729.083-.729 1.205.085 1.84 1.237 1.84 1.237 1.07 1.834 2.807 1.304 3.492.997.108-.775.418-1.305.76-1.604-2.665-.3-5.467-1.334-5.467-5.932 0-1.31.468-2.382 1.236-3.222-.124-.303-.536-1.523.116-3.176 0 0 1.008-.322 3.3 1.23a11.5 11.5 0 0 1 3.003-.403 11.5 11.5 0 0 1 3.003.403c2.29-1.553 3.296-1.23 3.296-1.23.654 1.653.242 2.873.118 3.176.77.84 1.235 1.913 1.235 3.222 0 4.61-2.807 5.63-5.48 5.922.43.37.823 1.102.823 2.222v3.293c0 .32.218.694.825.576C20.565 21.796 24 17.297 24 12c0-6.63-5.37-12-12-12z" />
      </svg>
      <span class="text-xl font-semibold">My Github</span>
      <form method="get" action="{{ url_for('explorer', branch=branch, subpath=subpath or '') }}">
        <select name="branch" onchange="this.form.submit()" class="border rounded px-2 py-1">
          {% for b in branches %}
            <option value="{{ b }}" {% if b == branch %}selected{% endif %}>{{ b }}</option>
          {% endfor %}
        </select>
        {% if subpath %}
          <input type="hidden" name="subpath" value="{{ subpath }}">
        {% endif %}
      </form>
      <span class="ml-2 text-gray-500">/ {{ subpath if subpath else "" }}</span>
    </div>
    <a href="{{ url_for('depot', branch=branch) }}" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Retour au d√©p√¥t</a>
  </div>
  <div class="flex">
    <!-- Sidebar -->
    <aside class="w-72 border-r bg-gray-50 min-h-screen p-4 overflow-y-auto">
      <h2 class="font-bold mb-2">Arborescence</h2>
      <ul>
        {% for folder in selected_folders %}
          <li>
            <a href="{{ url_for('explorer', branch=branch, subpath=folder|replace('\\', '/') ) }}" class="font-semibold text-blue-700 hover:underline">üìÅ {{ folder.split('/')[-1] }}</a>
          </li>
        {% endfor %}
        {% for file in selected_files %}
          <li>
            <a href="{{ url_for('explorer', branch=branch, subpath=file) }}" class="text-gray-800 hover:underline">üìù {{ file.split('/')[-1] }}</a>
          </li>
        {% endfor %}
      </ul>
    </aside>
    <!-- Main content -->
    <main class="flex-1 p-8">
      <table class="min-w-full border rounded bg-white">
        <thead>
          <tr class="bg-gray-100">
            <th class="text-left px-4 py-2">Author</th>
            <th class="text-left px-4 py-2">Commit message</th>
            <th class="text-left px-4 py-2">Date</th>
            <th class="text-left px-4 py-2">History</th>
          </tr>
        </thead>
        <tbody>
          {% if selected_file_name %}
            <tr>
              <td class="px-4 py-2 text-blue-700 font-semibold">
                {{ file_commits.get(selected_file_name, {}).get('auteur', '') }}
              </td>
              <td class="px-4 py-2 text-gray-700">
                {{ file_commits.get(selected_file_name, {}).get('message', '') }}
              </td>
              <td class="px-4 py-2 text-gray-700">
                {{ file_commits.get(selected_file_name, {}).get('date', '') }}
              </td>
              <td class="px-4 py-2">
                <span class="font-mono bg-gray-200 px-2 py-1 rounded">
                  {{ file_commits.get(selected_file_name, {}).get('hash', '') }}
                </span>
              </td>
            </tr>
          {% else %}
            {% for folder in selected_folders %}
              <tr>
                <td class="px-4 py-2 text-blue-700 font-semibold">
                  {{ folder_commits.get(folder.split('/')[-1], {}).get('author', '') }}
                </td>
                <td class="px-4 py-2 text-gray-700">
                  {{ folder_commits.get(folder.split('/')[-1], {}).get('message', '') }}
                </td>
                <td class="px-4 py-2 text-gray-700">
                  {{ folder_commits.get(folder.split('/')[-1], {}).get('date', '') }}
                </td>
                <td class="px-4 py-2">
                  <span class="font-mono bg-gray-200 px-2 py-1 rounded">
                    {{ folder_commits.get(folder.split('/')[-1], {}).get('hash', '') }}
                  </span>
                </td>
              </tr>
            {% endfor %}
            {% for file in selected_files %}
              <tr>
                <td class="px-4 py-2 text-blue-700 font-semibold">
                  {{ file_commits.get(file.split('/')[-1], {}).get('author', '') }}
                </td>
                <td class="px-4 py-2 text-gray-700">
                  {{ file_commits.get(file.split('/')[-1], {}).get('message', '') }}
                </td>
                <td class="px-4 py-2 text-gray-700">
                  {{ file_commits.get(file.split('/')[-1], {}).get('date', '') }}
                </td>
                <td class="px-4 py-2">
                  <span class="font-mono bg-gray-200 px-2 py-1 rounded">
                    {{ file_commits.get(file.split('/')[-1], {}).get('hash', '') }}
                  </span>
                </td>
              </tr>
            {% endfor %}
          {% endif %}
        </tbody>
      </table>
      {% if selected_file_content %}
        <h1 class="text-2xl font-bold mt-8 mb-4">{{ selected_file_name }}</h1>
        <div class="bg-gray-100 p-4 rounded overflow-x-auto markdown-body" style="max-width: 100%; word-break: break-word;">
          {% if selected_file_name.lower().endswith('.md') %}
            {{ selected_file_content|safe }}
          {% else %}
            <pre>{{ selected_file_content }}</pre>
          {% endif %}
        </div>
      {% endif %}
    </main>
  </div>
</body>
</html>